<template>
  <div>
    <div class="row" style="overflow-x:scroll">
      <div class="col-4 mb-2">
        <b-card-group deck style="min-height: 90px;">
          <b-card class="text-center small-box bg-info" >
            <b-card-text style="cursor: default !important;" >
              <h4 style="color: black">100 tỷ</h4>
              <h6 style="color: black"><b style="color: rgb(197,90,17 );">≈</b>15% GDP</h6>
              <div style="color: black">Dự toán thu</div>
            </b-card-text>
          </b-card>
        </b-card-group>
      </div>
      <div class="col-4 mb-2">
        <b-card-group deck style="min-height: 90px;">
          <b-card class="text-center bg-secondary" style="background-color: #ed7d31 !important;border-color: #ed7d31;">
            <b-card-text style="cursor: default !important;" >
              <h4 style="color: black">110 tỷ</h4>
              <h6 style="cursor: default !important;">
                <b style="color: green;">
                  <svg height="20" width="20" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="caret-up" class="svg-inline--fa fa-caret-up fa-w-10" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M288.662 352H31.338c-17.818 0-26.741-21.543-14.142-34.142l128.662-128.662c7.81-7.81 20.474-7.81 28.284 0l128.662 128.662c12.6 12.599 3.676 34.142-14.142 34.142z"></path></svg>
                </b>110% </h6>
              <div>Tổng thu</div>
            </b-card-text>
          </b-card>
        </b-card-group>
      </div>
      <div class="col-4 mb-2">
        <b-card-group deck style="min-height: 90px;">
          <b-card class="text-center bg-secondary" >
            <b-card-text style="cursor: default !important;" >
              <h4 style="color: black">109 tỷ</h4>
              <h6 style="cursor: default !important;">
                <b style="color:red;">
                  <svg height="20" width="20" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="caret-down" class="svg-inline--fa fa-caret-down fa-w-10" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M31.3 192h257.3c17.8 0 26.7 21.5 14.1 34.1L174.1 354.8c-7.8 7.8-20.5 7.8-28.3 0L17.2 226.1C4.6 213.5 13.5 192 31.3 192z"></path></svg>
                </b>
                1%</h6>
              <div>Quyết toán thu</div>
            </b-card-text>
          </b-card>
        </b-card-group>
      </div>

      <div class="col-4 mb-2">
        <b-card-group deck style="min-height: 90px;">
          <b-card class="text-center small-box bg-info">
            <b-card-text style="cursor: default !important;" >
              <h4 style="color: black">105 tỷ</h4>
              <h6 style="color: black"> 5%</h6>
              <div style="color: black">Dự toán chi</div>
            </b-card-text>
          </b-card>
        </b-card-group>
      </div>
      <div class="col-4 mb-2">
        <b-card-group deck style="min-height: 90px;">
          <b-card class="text-center small-box" style="background-color: #ed7d31 !important;border-color: #ed7d31;">
            <b-card-text style="cursor: default !important;" >
              <h4 style="color: white">115 tỷ </h4>
              <h6 > <b style="color: green"> <svg height="20" width="20" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="caret-up" class="svg-inline--fa fa-caret-up fa-w-10" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M288.662 352H31.338c-17.818 0-26.741-21.543-14.142-34.142l128.662-128.662c7.81-7.81 20.474-7.81 28.284 0l128.662 128.662c12.6 12.599 3.676 34.142-14.142 34.142z"></path></svg></b>9,52%
                <b style="color:yellow">
                  <svg height="20" width="20" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="caret-right" class="svg-inline--fa fa-caret-right fa-w-6" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192 512"><path fill="currentColor" d="M0 384.662V127.338c0-17.818 21.543-26.741 34.142-14.142l128.662 128.662c7.81 7.81 7.81 20.474 0 28.284L34.142 398.804C21.543 411.404 0 402.48 0 384.662z"></path></svg></b>4,55%</h6>
              <div style="color: white">Tổng chi</div>
            </b-card-text>
          </b-card>
        </b-card-group>
      </div>
      <div class="col-4 mb-2">
        <b-card-group deck>
          <b-card class="text-center small-box bg-secondary">
            <b-card-text style="cursor: default !important;" >
              <h4 style="color: black">113 tỷ </h4>
              <h6 >
                <b style="color: red;">
                  <svg height="20" width="20" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="caret-down" class="svg-inline--fa fa-caret-down fa-w-10" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M31.3 192h257.3c17.8 0 26.7 21.5 14.1 34.1L174.1 354.8c-7.8 7.8-20.5 7.8-28.3 0L17.2 226.1C4.6 213.5 13.5 192 31.3 192z"></path></svg></b>1.74%
                <b style="color:yellow">
                  <svg height="20" width="20" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="caret-right" class="svg-inline--fa fa-caret-right fa-w-6" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192 512"><path fill="currentColor" d="M0 384.662V127.338c0-17.818 21.543-26.741 34.142-14.142l128.662 128.662c7.81 7.81 7.81 20.474 0 28.284L34.142 398.804C21.543 411.404 0 402.48 0 384.662z"></path></svg></b>3,67%
              </h6>
              <div style="color: black">Quyết toán chi</div>
            </b-card-text>
          </b-card>
        </b-card-group>
      </div>
    </div>
    <div class="row">
      <div class="col-11">
        <canvas id="pie-chart" width="100px" height="100px"></canvas>
      </div>
      <div class="col-11">
        <canvas id="pie-chart-2" width="100px" height="100px"></canvas>
      </div>
    </div>

    <div class="row">
      <div class="col-23" >
        <div class="sort-area-7-left" style="float: left">
          <select class="dropdown" style="background-color: rgb(255 255 255)" id="sort-cocau-7-left">
            <option selected="true" disabled="disabled">Khoản thu</option>
            <option value="1">Khoản thu 1</option>
            <option value="2">Khoản thu 2</option>
            <option value="3">Khoản thu 3</option>
            <option value="3">Khoản thu 4</option>
          </select>
        </div>
        <div class="sort-area-7-right" style="float: right">
          <select class="dropdown" style="background-color: rgb(255 255 255)" id="sort-cocau-7-right">
            <option selected="true" disabled="disabled">Sắp xếp</option>
            <option value="1">Khoản thu</option>
            <option value="2">Giá trị giảm dần</option>
            <option value="3">Giá trị tăng dần</option>
          </select>
        </div>
        <canvas id="bar-chart-8" height="180px"></canvas>
      </div>

    </div>
    <div class="row">
      <div class="col-23" >
        <div class="sort-area-8-left" style="float: left">
          <select class="dropdown" style="background-color: rgb(255 255 255)" id="sort-cocau-8-left">
            <option selected="true" disabled="disabled">Khoản chi</option>
            <option value="1">Khoản chi 1</option>
            <option value="2">Khoản chi 2</option>
            <option value="3">Khoản chi 3</option>
            <option value="3">Khoản chi 4</option>
          </select>
        </div>
        <div class="sort-area-8-right" style="float: right">
          <select class="dropdown" style="background-color: rgb(255 255 255)" id="sort-cocau-8-right">
            <option selected="true" disabled="disabled">Sắp xếp</option>
            <option value="1">Khoản thu</option>
            <option value="2">Giá trị giảm dần</option>
            <option value="3">Giá trị tăng dần</option>
          </select>
        </div>
        <canvas id="bar-chart-9" height="180px"></canvas>
      </div>

    </div>
    <div class="row">
      <div class="col-23" >
        <canvas id="line-chart-8" height="180px"></canvas>
      </div>

    </div>
    <div class="row">
      <div class="col-23" >
        <canvas id="line-chart-9" height="180px"></canvas>
      </div>

    </div>
  </div>
</template>
<script>
  import ApiService from '@/services/api.service';
  import Chart from 'chart.js';
  import 'chartjs-plugin-labels';
  import 'chartjs-plugin-zoom';
  import moment from "moment";

  let PieChart = null;
  let PieChart2 = null;
  let BarChart8 = null;
  let BarChart9 = null;
  let LineChart8 = null;
  let LineChart9 = null;
  export default {
    name: 'dashboard-module-state-budget-expenses',
    props: {
      filter: [Array, Object]
    },
    data: function () {
      return {
        chartType: 1,
        optionDataPie: {
          labels: ['Ngân sách cấp', 'Thu phí, lệ phí', 'Thu dịch vụ', 'Thu khác'],
          datasets: [{
            label: '',
            data: [22, 16, 25, 15],
            backgroundColor: [
              '#2eadd3',
              '#ed7d31',
              '#a5aeb7',
              'rgb(99 87 52)'
            ],
            borderColor: [
              '#2eadd3',
              '#ed7d31',
              '#a5aeb7',
              'rgb(99 87 52)'
            ],
            borderWidth: null
          }]
        },
        optionDataPie2: {
          labels: ['Chi thường xuyên', 'Chi đầu tư phát triển', 'Chi tiền lương', 'Chi khác'],
          datasets: [{
            label: '',
            data: [15, 22, 16, 15],
            backgroundColor: [
              '#2eadd3',
              '#ed7d31',
              '#a5aeb7',
              'rgb(99 87 52)'
            ],
            borderColor: [
              '#2eadd3',
              '#ed7d31',
              '#a5aeb7',
              'rgb(99 87 52)'
            ],
            borderWidth: null
          }]
        },
        optionDataBar8: {
          labels: [
            'Khoản thu 1',
            'Khoản thu 2',
            'Khoản thu 3',
            'Khoản thu 4',
          ],
          datasets: [
            {
              label: "Dự toán chi",
              backgroundColor: "#2eadd3",
              fill: true,
              data: [ 8, 8, 4, 6],
            },
            {
              label: "Đã chi",
              backgroundColor: "#ed7d31",
              fill: true,
              data: [6, 7, 8, 5]
            },
            {
              label: "Đã thu",
              backgroundColor: "#a5aeb7",
              fill: true,
              data: [7, 6, 5, 7]
            },
          ]
        },
        optionDataBar9: {
          labels: [
            'Khoản chi 1',
            'Khoản chi 2',
            'Khoản chi 3',
            'Khoản chi 4',
          ],
          datasets: [
            {
              label: "Dự toán chi",
              backgroundColor: "#2eadd3",
              data: [9, 9, 3, 8],
            },
            {
              label: "Đã chi",
              backgroundColor: "#ed7d31",
              data: [6, 8, 4, 6]
            },
            {
              label: "Đã thu",
              backgroundColor: "#a5aeb7",
              fill: true,
              data: [7, 6, 5, 7]
            },

          ]
        },
        optionDataLineChar8: {
          labels: ['Chi NSNN theo cơ cấu chi (Tỷ dồng)'],
          datasets: [{
            label: '',
            data: [],
            backgroundColor: [],
            borderColor: [],
            borderWidth: null
          }]
        },
        optionDataLineChar9: {
          labels: ['Chi NSNN theo cơ cấu chi (Tỷ dồng)'],
          datasets: [{
            label: '',
            data: [],
            backgroundColor: [],
            borderColor: [],
            borderWidth: null
          }]
        }
      }
    },
    components: {},
    mounted () {
      let self = this;
      let ctxPie = document.getElementById('pie-chart');
      ctxPie.height = 60;
      let ctxPie2 = document.getElementById('pie-chart-2');
      ctxPie2.height = 60;
      PieChart = new Chart(ctxPie, {
        type: 'pie',
        data: {
          labels: self.optionDataPie.labels,
          datasets: [{
            label: '# of Votes',
            data: self.optionDataPie.datasets[0].data,
            backgroundColor: self.optionDataPie.datasets[0].backgroundColor,
            borderColor: self.optionDataPie.datasets[0].borderColor,
            borderWidth: 1
          }]
        },
        options: {
          scales: {
            // yAxes: [{
            //   ticks: {
            //     beginAtZero: true
            //   }
            // }]
          },

          title: {
            display: true,
            fontSize: 16,
            text: 'Quyết toán thu theo cơ cấu thu',
            position: "top"
          },
          legend: {
            display: true,
            position: 'bottom'
          },
          'onClick' : function (point, event) {
            // self.$router.push({
            //   name: 'report_STD_S02-DH-CH'
            // })
          },
          plugins: {
            labels: {
              render: 'percentage',
              precision: 2,
              fontColor: '#fff'
            },
            zoom: {
              // Container for pan options
              pan: {
                // Boolean to enable panning
                enabled: true,

                // Panning directions. Remove the appropriate direction to disable
                // Eg. 'y' would only allow panning in the y direction
                mode: 'xy'
              },

              // Container for zoom options
              zoom: {
                // Boolean to enable zooming
                enabled: true,

                // Zooming directions. Remove the appropriate direction to disable
                // Eg. 'y' would only allow zooming in the y direction
                mode: 'xy',
              }
            }
          }
        }
      });
      PieChart2 = new Chart(ctxPie2, {
        type: 'pie',
        data: {
          labels: self.optionDataPie2.labels,
          datasets: [{
            label: '# of Votes',
            data: self.optionDataPie2.datasets[0].data,
            backgroundColor: self.optionDataPie2.datasets[0].backgroundColor,
            borderColor: self.optionDataPie2.datasets[0].borderColor,
            borderWidth: 1
          }]
        },
        options: {
          scales: {
            // yAxes: [{
            //   ticks: {
            //     beginAtZero: true
            //   }
            // }]
          },

          title: {
            display: true,
            fontSize: 16,
            text: 'Quyết toán chi theo cơ cấu chi',
            position: "top"
          },
          legend: {
            display: true,
            position: 'bottom'
          },
          // 'onClick' : function (point, event) {
          //   self.$router.push({
          //     name: 'report_STD_S02-DH-CH'
          //   })
          // },
          plugins: {
            labels: {
              render: 'percentage',
              precision: 2,
              fontColor: '#fff'
            },
            zoom: {
              // Container for pan options
              pan: {
                // Boolean to enable panning
                enabled: true,

                // Panning directions. Remove the appropriate direction to disable
                // Eg. 'y' would only allow panning in the y direction
                mode: 'xy'
              },

              // Container for zoom options
              zoom: {
                // Boolean to enable zooming
                enabled: true,

                // Zooming directions. Remove the appropriate direction to disable
                // Eg. 'y' would only allow zooming in the y direction
                mode: 'xy',
              }
            }
          }
        }
      });
      let ctxBar8 = document.getElementById('bar-chart-8');
      let ctxBar9 = document.getElementById('bar-chart-9');
      ctxBar8.height = 60;
      ctxBar9.height = 60;
      BarChart8 = new Chart(ctxBar8, {
        type: 'bar',
        data: {
          labels: self.optionDataBar8.labels,
          datasets: self.optionDataBar8.datasets
        },
        options: {
          elements: {
            rectangle: {

            }
          },
          responsive: true,
          title: {
            display: true,
            text: 'Quyết toán thu theo danh mục thu',
            position: "top",
            fontSize: 16
          },
          legend: {
            display: true,
            position: 'bottom'
          },
          'onClick' : function (point, event) {
            // self.$router.push({
            //   name: 'report_BCDH_B02-DH-CH'
            // })
          },
          barValueSpacing: 10,
          scales: {
            xAxes: [{
              stacked: false,
              barPercentage: 0.8,
              // categoryPercentage: 1.0,
              gridLines: {
                offsetGridLines: true
              }
            }],
            yAxes: [{
              stacked: false,
              // ticks:{
              //   min: 0,
              // },
              beginAtZero: true,
              barPercentage: 0.6,
              gridLines: {
                display:false
              }
            }]
          },
          plugins: {
            labels: {
              render: function (args) {
                let max = 17; //This is the default 100% that will be used if no Max value is found
                try {
                  //Try to get the actual 100% and overwrite the old max value
                  max = Object.values(args.dataset.data).map((num) => {
                    return +num; //Convert num to integer
                  });
                  max = Math.max.apply(null, max);
                } catch (e) {}
                return (args.value);
              }
            },
            zoom: {
              pan: {
                enabled: true,
                mode: 'x',
                sensitivity: 0.25,
              },
              zoom: {
                enabled: true,
                mode: 'x',
                sensitivity: 0.25,
              }
            }
          }
        }
      });
      BarChart9 = new Chart(ctxBar9, {
        type: 'bar',
        data: {
          labels: self.optionDataBar9.labels,
          datasets: self.optionDataBar9.datasets
        },
        options: {
          elements: {
            rectangle: {

            }
          },
          responsive: true,
          title: {
            display: true,
            text: 'Quyết toán chi theo danh mục chi',
            position: "top",
            fontSize: 16
          },
          legend: {
            display: true,
            position: 'bottom'
          },
          'onClick' : function (point, event) {
            // self.$router.push({
            //   name: 'report_BCDH_B02-DH-CH'
            // })
          },
          barValueSpacing: 10,
          scales: {
            xAxes: [{
              stacked: false,
              barPercentage: 0.8,
              // categoryPercentage: 1.0,
              gridLines: {
                offsetGridLines: true
              }
            }],
            yAxes: [{
              stacked: false,
              // ticks:{
              //   min: 0,
              // },
              beginAtZero: true,
              barPercentage: 0.6,
              gridLines: {
                display:false
              }
            }]
          },
          plugins: {
            labels: {
              render: function (args) {
                let max = 17; //This is the default 100% that will be used if no Max value is found
                try {
                  //Try to get the actual 100% and overwrite the old max value
                  max = Object.values(args.dataset.data).map((num) => {
                    return +num; //Convert num to integer
                  });
                  max = Math.max.apply(null, max);
                } catch (e) {}
                return (args.value);
              }
            },
            zoom: {
              pan: {
                enabled: true,
                mode: 'x',
                sensitivity: 0.25,
              },
              zoom: {
                enabled: true,
                mode: 'x',
                sensitivity: 0.25,
              }
            }
          }
        }
      });


      let ctxLineChart8 = document.getElementById('line-chart-8');
      ctxLineChart8.height = 60;
      LineChart8 = new Chart(ctxLineChart8, {
        type: 'line',
        data: {
          labels: [
            'Năm 2016',
            'Năm 2017',
            'Năm 2018',
            'Năm 2019',
            'Năm 2020',
          ],
          datasets: [
            {
              label: 'Dự toán chi',
              data: [ 6, 5, 7, 5, 9],
              backgroundColor: '#2eadd3',
              fill: false,
              borderColor: '#2eadd3',
              tension: 0.1
            },
            {
              label: 'Đã chi',
              data: [ 6, 6, 8, 8, 6],
              borderColor: '#ed7d31',
              backgroundColor: '#ed7d31',
              fill: false,
              tension: 0.1
            },
            {
              label: 'Đã thu',
              data: [ 6, 6, 8, 6, 9],
              borderColor: '#a5aeb7',
              backgroundColor: '#a5aeb7',
              fill: false,
              tension: 0.1
            }
          ]
        },
        options: {
          title: {
            display: true,
            text: 'Quyết toán thu theo niên độ',
            position: "top",
            fontSize: 16
          },
          responsive: true,
          'onClick' : function (point, event) {
            // self.$router.push({
            //   name: 'report_BCDH_B02-DH-CH'
            // })
          },
          plugins: {
            legend: {
              position: 'bottom',
            },
            title: {
              display: true,
              text: 'Chart.js Line Chart'
            },
            zoom: {
              pan: {
                enabled: true,
                mode: 'x',
                sensitivity: 0.25,
              },
              zoom: {
                enabled: true,
                mode: 'x',
                sensitivity: 0.25,
              }
            }
          }
        }
      });
      let ctxLineChart9 = document.getElementById('line-chart-9');
      ctxLineChart9.height = 60;
      LineChart9 = new Chart(ctxLineChart9, {
        type: 'line',
        data: {
          labels: [
            'Năm 2016',
            'Năm 2017',
            'Năm 2018',
            'Năm 2019',
            'Năm 2020',
          ],
          datasets: [
            {
              label: 'Dự toán chi',
              data: [ 7, 9, 8, 7, 6],
              backgroundColor: '#2eadd3',
              fill: false,
              borderColor: '#2eadd3',
              tension: 0.1
            },
            {
              label: 'Đã chi',
              data: [9, 7, 6, 6, 3],
              borderColor: '#ed7d31',
              backgroundColor: '#ed7d31',
              fill: false,
              tension: 0.1
            },
            {
              label: 'Đã thu',
              data: [7, 8, 5, 7, 5],
              borderColor: '#a5aeb7',
              backgroundColor: '#a5aeb7',
              fill: false,
              tension: 0.1
            }
          ]
        },
        options: {
          title: {
            display: true,
            text: 'Quyết toán chi theo niên độ',
            position: "top",
            fontSize: 16
          },
          responsive: true,
          // 'onClick' : function (point, event) {
          //   self.$router.push({
          //     name: 'report_BCDH_B02-DH-CH'
          //   })
          // },
          plugins: {
            legend: {
              position: 'bottom',
            },
            title: {
              display: true,
              text: 'Chart.js Line Chart'
            },
            zoom: {
              pan: {
                enabled: true,
                mode: 'x',
                sensitivity: 0.25,
              },
              zoom: {
                enabled: true,
                mode: 'x',
                sensitivity: 0.25,
              }
            }
          }
        }
      });
    },
    methods: {
      changeChart(type){
        let datasetsPie = [];
        let labelsPie = [];
        let titlePie = '';
        let currentDataBar = this.optionDataBar.datasets[0].data;
        this.optionDataBar.datasets[0].data = [];
        let self = this;
        switch (type) {
          case 1:
            datasetsPie = [12, 30, 3, 5];
            labelsPie = ['Chi nội địa', 'Chi XNK', 'Chi viện trợ', 'Chi khác'];
            this.chartType = 1;
            titlePie = 'Dự toán chi';
            _.forEach(currentDataBar, function (value, key) {
              let randomNumber = _.random(0, 100);
              self.optionDataBar.datasets[0].data.push(randomNumber);
            });
            break;
          case 2:
            datasetsPie = [8, 23, 6, 9, 19, 25];
            labelsPie = ['Chi thường xuyên', 'Chi đầu tư phát triển', 'Chi cải cách tiền lương, tinh giảm biên chế', 'Chi viện trợ', 'Chi trả nợ', 'Chi khác'];
            this.chartType = 2;
            titlePie = 'Dự toán chi';
            _.forEach(currentDataBar, function (value, key) {
              let randomNumber = _.random(0, 100);
              self.optionDataBar.datasets[0].data.push(randomNumber);
            });
            break;
          case 3:
            datasetsPie = [11, 55, 32, 5];
            labelsPie = ['Chi nội địa', 'Chi XNK', 'Chi viện trợ', 'Chi khác'];
            this.chartType = 3;
            titlePie = 'Tổng chi';
            _.forEach(currentDataBar, function (value, key) {
              let randomNumber = _.random(0, 100);
              self.optionDataBar.datasets[0].data.push(randomNumber);
            });
            break;
          case 4:
            datasetsPie = [88, 32, 56, 78, 64];
            labelsPie = ['Chi thường xuyên', 'Chi đầu tư phát triển', 'Chi cải cách tiền lương, tinh giảm biên chế', 'Chi trả nợ', 'Chi khác'];
            this.chartType = 4;
            titlePie = 'Tổng chi';
            _.forEach(currentDataBar, function (value, key) {
              let randomNumber = _.random(0, 100);
              self.optionDataBar.datasets[0].data.push(randomNumber);
            });
            break;
          case 5:
            datasetsPie = [9, 45, 54, 6];
            labelsPie = ['Chi nội địa', 'Chi XNK', 'Chi viện trợ', 'Chi khác'];
            this.chartType = 5;
            titlePie = 'Quyết toán Chi';
            _.forEach(currentDataBar, function (value, key) {
              let randomNumber = _.random(0, 100);
              self.optionDataBar.datasets[0].data.push(randomNumber);
            });
            break;
          case 6:
            datasetsPie = [66, 33, 99, 50, 60];
            labelsPie = ['Chi thường xuyên', 'Chi đầu tư phát triển', 'Chi cải cách tiền lương, tinh giảm biên chế', 'Chi trả nợ', 'Chi khác'];
            this.chartType = 6;
            titlePie = 'Quyết toán chi';
            _.forEach(currentDataBar, function (value, key) {
              let randomNumber = _.random(0, 100);
              self.optionDataBar.datasets[0].data.push(randomNumber);
            });
            break;
          default:
            datasetsPie = [78, 45, 67, 54];
            labelsPie = ['Chi nội địa', 'Chi XNK', 'Chi viện trợ', 'Chi khác'];
            titlePie = 'Dự toán chi';
            this.optionDataBar.datasets[0].data = [];
            _.forEach(currentDataBar, function (value, key) {
              let randomNumber = _.random(0, 100);
              self.optionDataBar.datasets[0].data.push(randomNumber);
            });
            this.chartType = 1;
        }

        this.updateData(PieChart, labelsPie, [{data: datasetsPie}], titlePie);
        this.updateData(BarChart, [], [{data: self.optionDataBar.datasets[0].data}], '');
        this.updateData(BarChart2, [], [{data: self.optionDataBar2.datasets[0].data}], '');
        this.updateData(BarChart3, [], [{data: self.optionDataBar3.datasets[0].data}], '');
      },
      updateData(chart, labels = [], datasets, title = '') {
        if (labels.length) {
          chart.data.labels = labels;
        }
        chart.data.datasets.forEach((item, key) => {
          if (datasets && datasets[key] && datasets[key].data) {
            item.data = datasets[key].data;
          }
          if (datasets && datasets[key] && datasets[key].backgroundColor) {
            item.backgroundColor = datasets[key].backgroundColor;
          }
          if (datasets && datasets[key] && datasets[key].borderColor) {
            item.borderColor = datasets[key].borderColor;
          }
        });
        if (title) {
          chart.options.title.title = title;
          chart.config.options.title.text = title;
          chart.config.options.title.title = title;
        }
        chart.update();

        // chart.data.labels.push(labels);
        // chart.data.datasets.forEach((datasets) => {
        //   dataset.data.push(data);
        // });
      },
      removeData(chart) {
        chart.data.labels.pop();
        chart.data.datasets.forEach((dataset) => {
          dataset.data.pop();
        });
        chart.update();
      },
      getDistrict(){
        let self = this;
        let requestData = {
          url: 'dashboard/api/dashboard/get-district',
          method: 'post',
          data: {
            ProvinceID: this.filter.ProvinceID
          }
        };
        this.$store.commit('isLoading', true);
        ApiService.setHeader();
        ApiService.customRequest(requestData).then((responses) => {

          let responsesData = responses.data;
          if (responsesData.status === 1) {
            self.optionDataBar.labels = [];
            _.forEach(responsesData.data, function (district, key) {
              self.optionDataBar.labels.push(district.DistrictName);
            });
            _.forEach(self.optionDataBar.datasets, function (dataset, keyDataset) {
              self.optionDataBar.datasets[keyDataset].data = [];
              for (let i = 0; i < responsesData.data.length; i++) {
                let randomNumber = _.random(0, 100);
                self.optionDataBar.datasets[keyDataset].data.push(randomNumber);
              }
            });
            this.updateData(BarChart, self.optionDataBar.labels, self.optionDataBar.datasets, '');
          }
          self.$store.commit('isLoading', false);
        }, (error) => {
          console.log(error);
          self.$store.commit('isLoading', false);
        });
      },
      getCommune(){
        let self = this;
        let requestData = {
          url: 'dashboard/api/dashboard/get-commune',
          method: 'post',
          data: {
            DistrictID: this.filter.DistrictID
          }
        };
        this.$store.commit('isLoading', true);
        ApiService.setHeader();
        ApiService.customRequest(requestData).then((responses) => {

          let responsesData = responses.data;
          if (responsesData.status === 1) {
            self.optionDataBar.labels = [];
            _.forEach(responsesData.data, function (commune, key) {
              self.optionDataBar.labels.push(commune.CommuneName);
            });
            _.forEach(self.optionDataBar.datasets, function (dataset, keyDataset) {
              self.optionDataBar.datasets[keyDataset].data = [];
              for (let i = 0; i < responsesData.data.length; i++) {
                let randomNumber = _.random(0, 100);
                self.optionDataBar.datasets[keyDataset].data.push(randomNumber);
              }
            });
            this.updateData(BarChart, self.optionDataBar.labels, self.optionDataBar.datasets, '');
          }
          self.$store.commit('isLoading', false);
        }, (error) => {
          console.log(error);
          self.$store.commit('isLoading', false);
        });
      }
    },
    watch: {
      'filter.ProvinceID'(){
        if (this.filter.ProvinceID) {
          this.getDistrict();
        }
      },
      'filter.DistrictID'(){
        if (this.filter.DistrictID) {
          this.getCommune();
        }
      }
    }
  }
</script>
